From bounce-debian-bugs-dist==chris-lamb.co.uk@lists.debian.org Sun Apr 20 16:52:47 2008
Received: from liszt.debian.org ([82.195.75.100])
	by chris-lamb.co.uk with esmtps (TLS-1.0:DHE_RSA_AES_256_CBC_SHA1:32)
	(Exim 4.63)
	(envelope-from <bounce-debian-bugs-dist==chris-lamb.co.uk@lists.debian.org>)
	id 1JnbqC-0007uR-Jj
	for bot.address@chris-lamb.co.uk; Sun, 20 Apr 2008 16:52:46 +0100
Received: from localhost (localhost [127.0.0.1])
	by liszt.debian.org (Postfix) with QMQP
	id 4836D13A510A; Sun, 20 Apr 2008 15:52:30 +0000 (UTC)
Old-Return-Path: <debbugs@rietz.debian.org>
X-Spam-Checker-Version: SpamAssassin 3.2.3 (2007-08-08) on liszt.debian.org
X-Spam-Level: 
X-Spam-Status: No, score=-7.8 required=4.0 tests=BAYES_00,FOURLA,LDO_WHITELIST,
	MURPHY_SEX_L5,RCVD_IN_DNSWL_LOW autolearn=unavailable version=3.2.3
X-Original-To: debian-bugs-dist@lists.debian.org
Delivered-To: lists-debian-bugs-dist@liszt.debian.org
Received: from rietz.debian.org (rietz.debian.org [140.211.166.43])
	by liszt.debian.org (Postfix) with ESMTP id B348213A50E7;
	Sun, 20 Apr 2008 15:51:56 +0000 (UTC)
Received: from debbugs by rietz.debian.org with local (Exim 4.63)
	(envelope-from <debbugs@rietz.debian.org>)
	id 1Jnbnp-0003zo-MO; Sun, 20 Apr 2008 15:50:05 +0000
X-Loop: owner@bugs.debian.org
Subject: Bug#364119: Discussion on KDE lists about f(data)sync()
Reply-To: Sami Liedes <sliedes@cc.hut.fi>, 364119@bugs.debian.org
Resent-From: Sami Liedes <sliedes@cc.hut.fi>
Resent-To: debian-bugs-dist@lists.debian.org
Resent-CC: Debian Qt/KDE Maintainers <debian-qt-kde@lists.debian.org>
Resent-Date: Sun, 20 Apr 2008 15:50:05 +0000
Resent-Message-ID: <handler.364119.B364119.120870621821807@bugs.debian.org>
X-Debian-PR-Message: report 364119
X-Debian-PR-Package: kwin
X-Debian-PR-Keywords: moreinfo
X-Debian-PR-Source: kdebase
Received: via spool by 364119-submit@bugs.debian.org id=B364119.120870621821807
          (code B ref 364119); Sun, 20 Apr 2008 15:50:05 +0000
Received: (at 364119) by bugs.debian.org; 20 Apr 2008 15:43:38 +0000
X-Amavis-Spam-Status: No, score=-2.8 required=4.0 tests=BAYES_00,FOURLA,
	MURPHY_SEX_L5,UNPARSEABLE_RELAY autolearn=no 
	version=3.1.4-bugs.debian.org_2005_01_02
Received: from smtp-3.hut.fi ([130.233.228.93])
	by rietz.debian.org with esmtp (Exim 4.63)
	(envelope-from <sliedes@cc.hut.fi>)
	id 1JnbhY-0005Yx-Nc
	for 364119@bugs.debian.org; Sun, 20 Apr 2008 15:43:37 +0000
Received: from localhost (katosiko.hut.fi [130.233.228.115])
	by smtp-3.hut.fi (8.13.6/8.12.10) with ESMTP id m3KFhUMQ002997
	for <364119@bugs.debian.org>; Sun, 20 Apr 2008 18:43:30 +0300
Received: from smtp-3.hut.fi ([130.233.228.93])
 by localhost (katosiko.hut.fi [130.233.228.115]) (amavisd-new, port 10024)
 with LMTP id 17838-321-8 for <364119@bugs.debian.org>;
 Sun, 20 Apr 2008 18:43:29 +0300 (EEST)
Received: from vipunen.hut.fi (vipunen.hut.fi [130.233.228.9])
	by smtp-3.hut.fi (8.13.6/8.12.10) with ESMTP id m3KFgWK3002616
	for <364119@bugs.debian.org>; Sun, 20 Apr 2008 18:42:33 +0300
Received: (from sliedes@localhost)
	by vipunen.hut.fi (8.12.10/8.12.10/Submit) id m3KFgW9T002438
	for 364119@bugs.debian.org; Sun, 20 Apr 2008 18:42:32 +0300 (EEST)
Date: Sun, 20 Apr 2008 18:42:31 +0300
From: Sami Liedes <sliedes@cc.hut.fi>
To: 364119@bugs.debian.org
Message-ID: <20080420154231.GD8760@nun4.kyla.fi>
MIME-Version: 1.0
Content-Type: multipart/signed; micalg=pgp-sha1;
	protocol="application/pgp-signature"; boundary="DiL7RhKs8rK9YGuF"
Content-Disposition: inline
User-Agent: Mutt/1.5.17+20080114 (2008-01-14)
X-TKK-Virus-Scanned: by amavisd-new-2.1.2-hutcc at katosiko.hut.fi
Resent-Date: Sun, 20 Apr 2008 15:50:05 +0000
X-Debian-Message: from BTS
X-Rc-Virus: 2007-09-13_01
X-Rc-Spam: 2007-10-04_01
X-Mailing-List: <debian-bugs-dist@lists.debian.org> archive/latest/343576
X-Loop: debian-bugs-dist@lists.debian.org
List-Id: <debian-bugs-dist.lists.debian.org>
List-Post: <mailto:debian-bugs-dist@lists.debian.org>
List-Help: <mailto:debian-bugs-dist-request@lists.debian.org?subject=help>
List-Subscribe: <mailto:debian-bugs-dist-request@lists.debian.org?subject=subscribe>
List-Unsubscribe: <mailto:debian-bugs-dist-request@lists.debian.org?subject=unsubscribe>
Precedence: list
Resent-Sender: debian-bugs-dist-request@lists.debian.org
Received-SPF: none
X-SPF-Guess: pass
X-Spam-Score: -40.2
X-Spam-Report: (-40.2 points, 5.0 required)
	pts rule name              description
	---- ---------------------- --------------------------------------------------
	-50 D_FOR_BOT              For debian-devel-changes bot
	0.0 UNPARSEABLE_RELAY      Informational: message has unparseable relay lines
	-2.6 BAYES_00               BODY: Bayesian spam probability is 0 to 1%
	[score: 0.0000]
	12 AWL                    AWL: From: address is in the auto white-list


--DiL7RhKs8rK9YGuF
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline

Hi,

I too noticed this as a truly major performance issue on my desktop
and can see how this is a problem on a laptop so I took the issue to
the kde-devel mailing list.

Unfortunately it seems that some KDE developers think fsync()ing data
to disk every now and then

1. is not a major performance issue, and
2. is actually good practice.

(I haven't given up hope yet they can be persuaded this is Wrong.)

Basically, nearly all fsync()s KDE does can be disabled by replacing
"result = FDATASYNC(mFd)" in kdelibs-3.5.9/kdecore/ktempfile.cpp by
"result = 0". This is a hack, but the only piece in KDE I have figured
out so far actually should need fsync() for anything is KShred (trying
to securely wipe files). As the fsync() system call is explicitly
allowed to be a nop (and is so for NFS on Linux I think, on some BSDs
it's not), this should not break anything unless your system crashes
or you lose power suddenly. Even then it's a risk pretty much every
software takes, and I think KDE shouldn't force synchronous file
access down my throat.

Anyway, I did the change I mentioned above, and the difference in
speed is truly amazing. KDE starts in a few tenths of a second,
Konqueror no longer makes me wait for seconds with medium disk loads,
etc.

According to one bug report and followup discussion, KMail even goes
as far as to issue sync() system calls to sync _all dirty kernel
buffers_, no matter whose, to disk[1], which is evil and broken
behavior enough to make me want to rm the kmail binary :). It should
be obvious this totally ruins the performance for any multiuser setup.

Here's the most recent thread I initiated:

http://lists.kde.org/?l=kde-devel&m=120861637525158&w=2

and here are some older threads/mails discussing the issue:

http://lists.kde.org/?l=kde-core-devel&m=97502254108121&w=2
http://lists.kde.org/?l=kde-core-devel&m=108987991924336&w=2
http://lists.kde.org/?l=kde-devel&m=119255926531628&w=2
http://lists.kde.org/?l=kde-core-devel&m=108971672603299&w=2

Some KDE bugs related to the issue:

http://bugs.kde.org/show_bug.cgi?id=110318
http://bugs.kde.org/show_bug.cgi?id=142462
http://bugs.kde.org/show_bug.cgi?id=90042
http://bugs.kde.org/show_bug.cgi?id=146789

	Sami


[1] http://bugs.kde.org/show_bug.cgi?id=90042

--DiL7RhKs8rK9YGuF
Content-Type: application/pgp-signature; name="signature.asc"
Content-Description: Digital signature
Content-Disposition: inline

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.6 (GNU/Linux)

iD8DBQFIC2Rnyc0QC7DZBM8RAkp6AJ4/H9yw7noSONnNEPbDA1+w6eYFygCgy6ri
+YWi/Twj9JfRfaIW1l1laaE=
=wldK
-----END PGP SIGNATURE-----

--DiL7RhKs8rK9YGuF--



-- 
To UNSUBSCRIBE, email to debian-bugs-dist-REQUEST@lists.debian.org
with a subject of "unsubscribe". Trouble? Contact listmaster@lists.debian.org



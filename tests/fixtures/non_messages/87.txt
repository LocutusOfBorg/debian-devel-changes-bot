From bounce-debian-bugs-dist==chris-lamb.co.uk@lists.debian.org Sun Apr 20 08:47:59 2008
Received: from liszt.debian.org ([82.195.75.100])
	by chris-lamb.co.uk with esmtps (TLS-1.0:DHE_RSA_AES_256_CBC_SHA1:32)
	(Exim 4.63)
	(envelope-from <bounce-debian-bugs-dist==chris-lamb.co.uk@lists.debian.org>)
	id 1JnUH8-0005kc-Dj
	for bot.address@chris-lamb.co.uk; Sun, 20 Apr 2008 08:47:58 +0100
Received: from localhost (localhost [127.0.0.1])
	by liszt.debian.org (Postfix) with QMQP
	id 53C5713A4E78; Sun, 20 Apr 2008 07:47:49 +0000 (UTC)
Old-Return-Path: <debbugs@rietz.debian.org>
X-Spam-Checker-Version: SpamAssassin 3.2.3 (2007-08-08) on liszt.debian.org
X-Spam-Level: 
X-Spam-Status: No, score=-8.0 required=4.0 tests=BAYES_00,LDO_WHITELIST,
	MURPHY_DRUGS_REL8,RCVD_IN_DNSWL_LOW autolearn=ham version=3.2.3
X-Original-To: debian-bugs-dist@lists.debian.org
Delivered-To: lists-debian-bugs-dist@liszt.debian.org
Received: from rietz.debian.org (rietz.debian.org [140.211.166.43])
	by liszt.debian.org (Postfix) with ESMTP id 1A2F113A4CF9;
	Sun, 20 Apr 2008 07:47:36 +0000 (UTC)
Received: from debbugs by rietz.debian.org with local (Exim 4.63)
	(envelope-from <debbugs@rietz.debian.org>)
	id 1JnUEe-00043Q-PF; Sun, 20 Apr 2008 07:45:16 +0000
X-Loop: owner@bugs.debian.org
Subject: Bug#473175: apt-listbugs: pinned packages are not automatically unpinned
Reply-To: Junichi Uekawa <dancer@netfort.gr.jp>, 473175@bugs.debian.org
Resent-From: Junichi Uekawa <dancer@netfort.gr.jp>
Resent-To: debian-bugs-dist@lists.debian.org
Resent-CC: Junichi Uekawa <dancer@debian.org>
Resent-Date: Sun, 20 Apr 2008 07:45:15 +0000
Resent-Message-ID: <handler.473175.B473175.120867648119335@bugs.debian.org>
X-Debian-PR-Message: report 473175
X-Debian-PR-Package: apt-listbugs
X-Debian-PR-Keywords: 
X-Debian-PR-Source: apt-listbugs
Received: via spool by 473175-submit@bugs.debian.org id=B473175.120867648119335
          (code B ref 473175); Sun, 20 Apr 2008 07:45:15 +0000
Received: (at 473175) by bugs.debian.org; 20 Apr 2008 07:28:01 +0000
X-Amavis-Spam-Status: No, score=-7.0 required=4.0 tests=BAYES_00,HAS_BUG_NUMBER,
	MURPHY_DRUGS_REL8 autolearn=no 
	version=3.1.4-bugs.debian.org_2005_01_02
Received: from aegis.netfort.gr.jp ([219.94.144.215] ident=qmailr)
	by rietz.debian.org with smtp (Exim 4.63)
	(envelope-from <dancer@netfort.gr.jp>)
	id 1JnTxw-0004yn-Uk
	for 473175@bugs.debian.org; Sun, 20 Apr 2008 07:28:01 +0000
Received: (qmail 14960 invoked by uid 0); 20 Apr 2008 07:27:58 -0000
Received: from unknown (HELO dancer64.netfort.gr.jp.netfort.gr.jp) (127.0.0.1)
  by aegis.netfort.gr.jp with SMTP; 20 Apr 2008 07:27:58 -0000
Date: Sun, 20 Apr 2008 16:27:58 +0900
Message-ID: <8763udgf41.dancerj%dancer@netfort.gr.jp>
From: Junichi Uekawa <dancer@netfort.gr.jp>
To: Francesco Poli <frx@firenze.linux.it>,
	473175@bugs.debian.org
In-Reply-To: <20080412172537.b75f75c9.frx@firenze.linux.it>
References: <20080328231810.6982.159.reportbug@homebrew>
	<87prtcu7tr.dancerj%dancer@netfort.gr.jp>
	<20080330111844.4dd9483d.frx@firenze.linux.it>
	<20080412162728.8cc6f360.frx@firenze.linux.it>
	<20080412172537.b75f75c9.frx@firenze.linux.it>
User-Agent: Wanderlust/2.14.0 (Africa) SEMI/1.14.6 (Maruoka) FLIM/1.14.9
 =?UTF-8?Q?(Goj=C5=8D)?= APEL/10.7 Emacs/22.1 (x86_64-pc-linux-gnu)
 MULE/5.0 (SAKAKI)
MIME-Version: 1.0 (generated by SEMI 1.14.6 - "Maruoka")
Content-Type: text/plain; charset=US-ASCII
Resent-Date: Sun, 20 Apr 2008 07:45:16 +0000
X-Debian-Message: from BTS
X-Rc-Virus: 2007-09-13_01
X-Rc-Spam: 2007-10-04_01
X-Mailing-List: <debian-bugs-dist@lists.debian.org> archive/latest/343347
X-Loop: debian-bugs-dist@lists.debian.org
List-Id: <debian-bugs-dist.lists.debian.org>
List-Post: <mailto:debian-bugs-dist@lists.debian.org>
List-Help: <mailto:debian-bugs-dist-request@lists.debian.org?subject=help>
List-Subscribe: <mailto:debian-bugs-dist-request@lists.debian.org?subject=subscribe>
List-Unsubscribe: <mailto:debian-bugs-dist-request@lists.debian.org?subject=unsubscribe>
Precedence: list
Resent-Sender: debian-bugs-dist-request@lists.debian.org
Received-SPF: none
X-SPF-Guess: pass
X-Spam-Score: -37.8
X-Spam-Report: (-37.8 points, 5.0 required)
	pts rule name              description
	---- ---------------------- --------------------------------------------------
	-50 D_FOR_BOT              For debian-devel-changes bot
	0.0 UNPARSEABLE_RELAY      Informational: message has unparseable relay lines
	-2.6 BAYES_00               BODY: Bayesian spam probability is 0 to 1%
	[score: 0.0000]
	15 AWL                    AWL: From: address is in the auto white-list

Hi,

> Again assuming that the above is correct, I don't think that this logic
> is appropriate for aptcleanup. That is to say, I don't think that
> waiting for the pinned package to be non-RC-buggy before unpinning it
> is the right thing to do.
> 
> The reason is: when I ask apt-listbugs to pin a package for me, I do so
> because the new version that would otherwise be installed is affected
> by some bugs that I think would have an unacceptable impact on my
> system.  From now on, I will call these bugs "the bugs that I fear".
> The bugs that I fear are automatically annotated by apt-listbugs
> in /etc/apt/preferences in Explanation: fields.
> When the bugs that I fear "go away" (either because they have been
> downgraded below the RC threshold, or because they have been fixed in a
> newly available version of the package, or because they have been
> reassigned to another package), the previously pinned package should be
> unpinned, *even if* there are other new RC-bugs that affect the newly
> available version.
> If there are no other RC-bugs that affect the newly available version
> of the package, the package will be upgraded during the next "aptitude
> safe-upgrade" run.
> On the other hand, if there are other RC-bugs, the package will be
> ready to be upgraded during the next "aptitude safe-upgrade" run and
> apt-listbugs will kick in alerting the user about the new RC-bugs: the
> user will examine those new RC-bugs and decide whether to pin the
> package again or else let the upgrade happen.
> 
> This seems the right behavior to me.
> aptcleanup should only care about the bugs that I fear, when deciding
> whether to unpin a package.
> 
> 
> How can this be achieved?
> I think the design of aptcleanup could be changed as follows.
> 
> 
> 0) parse /etc/apt/preferences, reading pinned packages and the bugs
>    that explain their pinning ("bugs that the user fear")
> 1) for each pinned package
>    1.1) determine the unpinned_candidate_version (that is to say, the
>         version that would be installed if the pinning were removed)
>    1.2) for each bug that the user fears
>         1.2.1) query the BTS about the bug and find out whether the bug
>                is still present *and* still RC in the
>                unpinned_candidate_version
>    1.3) if all the bugs that the user fears went away, then the package
>         should be unpinned, hence do not include it in the list of buggy
>         packages
>    1.4) if on the other hand some bugs that the user fears haven't yet
>         gone away, then the package should stay pinned, hence include
>         it in the list of buggy packages
> 2) compare the list of pinned packages with the list of buggy packages
>    and spit out a new preferences file which only pins buggy packages
> 
> 
> How do I determine the unpinned_candidate_version of PACKAGE?
> Something like the following, I would say:
> 
> $ apt-cache -o Dir::Etc::Preferences=/dev/null policy PACKAGE | awk '/Candidate:/ { print $2; }'
> 
> 
> Well, what do you think about my proposed redesign of aptcleanup?
> Is it reasonable?
> Is it feasible?
> Or am I missing something important?

Your logic sounds reasonable, patch is welcome. It's going to be a
major rewrite since aptcleanup currently is a very simple script.


regards,
	junichi
-- 
dancer@{debian.org,netfort.gr.jp}   Debian Project



-- 
To UNSUBSCRIBE, email to debian-bugs-dist-REQUEST@lists.debian.org
with a subject of "unsubscribe". Trouble? Contact listmaster@lists.debian.org


